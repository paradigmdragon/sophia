<!doctype html>
<html lang="ko">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Sophia Canopy</title>
  <script type="module">
    import mermaid from "https://cdn.jsdelivr.net/npm/mermaid@11/dist/mermaid.esm.min.mjs";
    mermaid.initialize({ startOnLoad: true, theme: "dark" });
  </script>
  <style>
    body { margin: 0; background: #0b1020; color: #e5e7eb; font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif; }
    .wrap { padding: 20px; display: grid; gap: 14px; }
    .card { background: #111827; border: 1px solid #374151; border-radius: 10px; padding: 12px; }
    .row { display: flex; gap: 12px; flex-wrap: wrap; }
    .pill { background: #1f2937; border: 1px solid #4b5563; border-radius: 999px; padding: 4px 10px; font-size: 12px; }
    .title { font-size: 16px; font-weight: 700; margin: 0 0 8px 0; }
    .sub { color: #9ca3af; font-size: 12px; }
    .list { font-size: 12px; line-height: 1.5; max-height: 240px; overflow: auto; white-space: pre-wrap; }
  </style>
</head>
<body>
  <div class="wrap">
    <div class="card">
      <p class="title">Canopy Status</p>
      <div class="row">
        <span class="pill">READY: 0</span>
        <span class="pill">IN_PROGRESS: 0</span>
        <span class="pill">DONE: 2</span>
        <span class="pill">BLOCKED: 3</span>
        <span class="pill">FAILED: 0</span>
        <span class="pill">UNVERIFIED: 5</span>
      </div>
      <p class="sub">상태 계산: DB 기반(read-only) · Forest는 export view</p>
    </div>
    <div class="card">
      <p class="title">Question Queue / Work Queue / Recent Events</p>
      <div class="mermaid">flowchart TD
subgraph WorkQueue["Work Queue"]
wp_10cee24315eb4af4ba50c97d61d58713["S2\n[BLOCKED]"]:::BLOCKED
wp_cff76fb7e8ff4229ae0211276eb2b67b["S1\n[DONE]"]:::DONE
wp_c810ebe8cdf04fd49d9425c187dc4af5["Rehearsal S2\n[BLOCKED]"]:::BLOCKED
wp_df90a9828201480db81954abc99fd5ab["Rehearsal S1\n[DONE]"]:::DONE
wp_c910e1aaf5234682b4f2c204822fd480["Part4.5 rehearsal package\n[BLOCKED]"]:::BLOCKED
end
subgraph QuestionQueue["Question Queue"]
q_scope_s2["scope_s2\n[UNVERIFIED]"]:::UNVERIFIED
q_scope_s2b["scope_s2b\n[UNVERIFIED]"]:::UNVERIFIED
q_dep_s1["dep_s1\n[UNVERIFIED]"]:::UNVERIFIED
q_dep_s1b["dep_s1b\n[UNVERIFIED]"]:::UNVERIFIED
q_dependency_missing["dependency_missing\n[UNVERIFIED]"]:::UNVERIFIED
end
classDef READY fill:#1e3a8a,stroke:#93c5fd,color:#dbeafe;
classDef IN_PROGRESS fill:#0f766e,stroke:#5eead4,color:#ccfbf1;
classDef DONE fill:#14532d,stroke:#86efac,color:#dcfce7;
classDef BLOCKED fill:#7f1d1d,stroke:#fca5a5,color:#fee2e2;
classDef FAILED fill:#4c0519,stroke:#f9a8d4,color:#fce7f3;
classDef UNVERIFIED fill:#78350f,stroke:#fcd34d,color:#fef3c7;</div>
    </div>
    <div class="card">
      <p class="title">Recent Events</p>
      <div class="list">[
  {
    "timestamp": "2026-02-16T23:23:49.428550Z",
    "event_type": "QUESTION_READY",
    "target": "dependency_missing",
    "summary": "question ready: risk=0.72",
    "payload": {
      "cluster_id": "dependency_missing",
      "hit_count": 3,
      "risk_score": 0.72
    }
  },
  {
    "timestamp": "2026-02-16T23:23:49.468535Z",
    "event_type": "QUESTION_SIGNAL",
    "target": "dependency_missing",
    "summary": "question signal: hit=3 risk=0.72",
    "payload": {
      "cluster_id": "dependency_missing",
      "hit_count": 3,
      "risk_score": 0.72,
      "status": "ready_to_ask"
    }
  },
  {
    "timestamp": "2026-02-16T23:23:49.494947Z",
    "event_type": "QUESTION_ASKED",
    "target": "dependency_missing",
    "summary": "question asked: count=1",
    "payload": {
      "cluster_id": "dependency_missing",
      "asked_count": 1,
      "risk_score": 0.72,
      "message_id": "msg_8d52fd946e4d4767b731f415c3e0bdbe"
    }
  },
  {
    "timestamp": "2026-02-16T23:23:49.544617Z",
    "event_type": "QUESTION_SIGNAL",
    "target": "dependency_missing",
    "summary": "question signal: hit=4 risk=0.72",
    "payload": {
      "cluster_id": "dependency_missing",
      "hit_count": 4,
      "risk_score": 0.72,
      "status": "pending"
    }
  },
  {
    "timestamp": "2026-02-16T23:23:49.595415Z",
    "event_type": "QUESTION_ACKNOWLEDGED",
    "target": "dependency_missing",
    "summary": "event: QUESTION_ACKNOWLEDGED",
    "payload": {
      "cluster_id": "dependency_missing",
      "question_status": "acknowledged",
      "messages_updated": 1
    }
  },
  {
    "timestamp": "2026-02-16T23:23:49.641332Z",
    "event_type": "MESSAGE_READ",
    "target": "msg_8d52fd946e4d4767b731f415c3e0bdbe",
    "summary": "event: MESSAGE_READ",
    "payload": {
      "message_id": "msg_8d52fd946e4d4767b731f415c3e0bdbe",
      "status": "acknowledged",
      "linked_cluster": "dependency_missing"
    }
  },
  {
    "timestamp": "2026-02-16T23:23:49.689419Z",
    "event_type": "QUESTION_RESOLVED",
    "target": "dependency_missing",
    "summary": "question resolved",
    "payload": {
      "cluster_id": "dependency_missing",
      "messages_updated": 1,
      "question_status": "resolved"
    }
  },
  {
    "timestamp": "2026-02-16T23:23:49.763670Z",
    "event_type": "QUESTION_SIGNAL",
    "target": "scope_ambiguity",
    "summary": "question signal: hit=1 risk=0.6",
    "payload": {
      "cluster_id": "scope_ambiguity",
      "hit_count": 1,
      "risk_score": 0.6,
      "status": "collecting"
    }
  },
  {
    "timestamp": "2026-02-16T23:23:49.826716Z",
    "event_type": "QUESTION_READY",
    "target": "scope_ambiguity",
    "summary": "question ready: risk=0.82",
    "payload": {
      "cluster_id": "scope_ambiguity",
      "hit_count": 2,
      "risk_score": 0.82
    }
  },
  {
    "timestamp": "2026-02-16T23:23:49.878011Z",
    "event_type": "QUESTION_SIGNAL",
    "target": "scope_ambiguity",
    "summary": "question signal: hit=2 risk=0.82",
    "payload": {
      "cluster_id": "scope_ambiguity",
      "hit_count": 2,
      "risk_score": 0.82,
      "status": "ready_to_ask"
    }
  },
  {
    "timestamp": "2026-02-16T23:23:49.922706Z",
    "event_type": "QUESTION_ASKED",
    "target": "scope_ambiguity",
    "summary": "question asked: count=1",
    "payload": {
      "cluster_id": "scope_ambiguity",
      "asked_count": 1,
      "risk_score": 0.82,
      "message_id": "msg_b49272b84d5c40b083a988d084fcf163"
    }
  },
  {
    "timestamp": "2026-02-16T23:23:49.967210Z",
    "event_type": "QUESTION_RESOLVED",
    "target": "scope_ambiguity",
    "summary": "question resolved",
    "payload": {
      "project": "sophia",
      "cluster_id": "scope_ambiguity",
      "messages_updated": 1,
      "question_status": "resolved"
    }
  },
  {
    "timestamp": "2026-02-16T23:23:50.009843Z",
    "event_type": "QUESTION_RESPONSE_ANALYZED",
    "target": "scope_ambiguity",
    "summary": "event: QUESTION_RESPONSE_ANALYZED",
    "payload": {
      "project": "sophia",
      "cluster_id": "scope_ambiguity",
      "signals": 1,
      "source_doc": "question_response_scope_ambiguity_20260216_232349.md"
    }
  },
  {
    "timestamp": "2026-02-16T23:23:50.054252Z",
    "event_type": "ETHICS_FIX_COMMITTED",
    "target": "sophia",
    "summary": "event: ETHICS_FIX_COMMITTED",
    "payload": {
      "project": "sophia",
      "endpoint": "/chat/messages",
      "task": "chat.timeline_append",
      "trace_id": "req_6fa321e290c54dfbab7157f10cf25274",
      "provider_final": "local",
      "fallback_applied": false,
      "gate_reason": "",
      "generation": {
        "provider": "ollama",
        "model": "unknown",
        "route": "local",
        "capabilities": {
          "web_access": false,
          "file_access": false,
          "exec_access": false,
          "device_actions": false
        },
        "latency_ms": 1,
        "tokens_in": null,
        "tokens_out": null,
        "trace_id": "req_6fa321e290c54dfbab7157f10cf25274",
        "created_at": "2026-02-16T23:23:49.823388Z",
        "shortcuts_request": false,
        "shortcuts_signature_valid": null,
        "shortcuts_status": "UNVERIFIED",
        "integration": {
          "apple": {
            "shortcuts": "UNVERIFIED"
          }
        }
      },
      "ethics": {
        "outcome": "FIX",
        "reason_codes": [],
        "required_inputs": null,
        "next_action": null,
        "patch": null,
        "commit_meta": {
          "event_id": "cmt_be2598fda2d848e295113b617f9489b9",
          "timestamp": "2026-02-16T23:23:50.054023Z",
          "subject": "reply",
          "source": "assistant",
          "facet": "CANDIDATE",
          "refs": [
            "question-queue",
            "msg_46dcaa4fe2b84855aa8f179f0685856d",
            "msg_6103d4efa70948b4bdb8e1811de36dae"
          ],
          "hash": "sha256:e16d27c6aee337ccd33612ac34639caf5a50a18d5814d2ca60a74b8b1b9389c5",
          "policy_version": "ethics_protocol_v1_0",
          "redaction": {
            "pii_removed": false,
            "fields": []
          },
          "review": {
            "required": true,
            "state": "pending"
          }
        }
      }
    }
  },
  {
    "timestamp": "2026-02-16T23:23:50.143950Z",
    "event_type": "ETHICS_FIX_COMMITTED",
    "target": "sophia",
    "summary": "event: ETHICS_FIX_COMMITTED",
    "payload": {
      "project": "sophia",
      "endpoint": "/chat/messages",
      "task": "chat.timeline_append",
      "trace_id": "req_139a12e3cdb44dd082213ad778633d9c",
      "provider_final": "local",
      "fallback_applied": false,
      "gate_reason": "",
      "generation": {
        "provider": "ollama",
        "model": "unknown",
        "route": "local",
        "capabilities": {
          "web_access": false,
          "file_access": false,
          "exec_access": false,
          "device_actions": false
        },
        "latency_ms": 1,
        "tokens_in": null,
        "tokens_out": null,
        "trace_id": "req_139a12e3cdb44dd082213ad778633d9c",
        "created_at": "2026-02-16T23:23:50.143363Z",
        "shortcuts_request": false,
        "shortcuts_signature_valid": null,
        "shortcuts_status": "UNVERIFIED",
        "integration": {
          "apple": {
            "shortcuts": "UNVERIFIED"
          }
        }
      },
      "ethics": {
        "outcome": "FIX",
        "reason_codes": [],
        "required_inputs": null,
        "next_action": null,
        "patch": null,
        "commit_meta": {
          "event_id": "cmt_2d023e8339bc4d8eae23229e29ed5daf",
          "timestamp": "2026-02-16T23:23:50.143779Z",
          "subject": "reply",
          "source": "assistant",
          "facet": "CANDIDATE",
          "refs": [
            "chat",
            "msg_9789d34d6bc646688feaee1567f8fb1e",
            "msg_9f1ee51eb05940f4a1837b81f3cac9c9"
          ],
          "hash": "sha256:185b4ba037b0a12b5d387fd60a80ac9697a6c33945f28f730baa4c9aac21699c",
          "policy_version": "ethics_protocol_v1_0",
          "redaction": {
            "pii_removed": false,
            "fields": []
          },
          "review": {
            "required": true,
            "state": "pending"
          }
        }
      }
    }
  },
  {
    "timestamp": "2026-02-16T23:23:50.245632Z",
    "event_type": "ETHICS_FIX_COMMITTED",
    "target": "sophia",
    "summary": "event: ETHICS_FIX_COMMITTED",
    "payload": {
      "project": "sophia",
      "endpoint": "/chat/messages",
      "task": "chat.timeline_append",
      "trace_id": "req_a002c421bf9c45e6963e48af889376c8",
      "provider_final": "local",
      "fallback_applied": false,
      "gate_reason": "",
      "generation": {
        "provider": "ollama",
        "model": "unknown",
        "route": "local",
        "capabilities": {
          "web_access": false,
          "file_access": false,
          "exec_access": false,
          "device_actions": false
        },
        "latency_ms": 1,
        "tokens_in": null,
        "tokens_out": null,
        "trace_id": "req_a002c421bf9c45e6963e48af889376c8",
        "created_at": "2026-02-16T23:23:50.245176Z",
        "shortcuts_request": false,
        "shortcuts_signature_valid": null,
        "shortcuts_status": "UNVERIFIED",
        "integration": {
          "apple": {
            "shortcuts": "UNVERIFIED"
          }
        }
      },
      "ethics": {
        "outcome": "FIX",
        "reason_codes": [],
        "required_inputs": null,
        "next_action": null,
        "patch": null,
        "commit_meta": {
          "event_id": "cmt_9c364237316d48eab1b6f81f42051e74",
          "timestamp": "2026-02-16T23:23:50.245483Z",
          "subject": "reply",
          "source": "assistant",
          "facet": "CANDIDATE",
          "refs": [
            "chat",
            "msg_7cf37da4ed8f447bb52d1088828f55de",
            "msg_f7389248862c423f96bd9254471b3357"
          ],
          "hash": "sha256:fbccbbf5f870eaa74cf64013be0a5a44d4374e79ddc8d953d787c0427fb95efe",
          "policy_version": "ethics_protocol_v1_0",
          "redaction": {
            "pii_removed": false,
            "fields": []
          },
          "review": {
            "required": true,
            "state": "pending"
          }
        }
      }
    }
  },
  {
    "timestamp": "2026-02-16T23:23:50.365444Z",
    "event_type": "ETHICS_FIX_COMMITTED",
    "target": "sophia",
    "summary": "event: ETHICS_FIX_COMMITTED",
    "payload": {
      "project": "sophia",
      "endpoint": "/chat/message",
      "task": "chat.reply",
      "trace_id": "req_79dd62c25ba84bcca927cc379124931a",
      "provider_final": "local",
      "fallback_applied": false,
      "gate_reason": "",
      "generation": {
        "provider": "mock",
        "model": "local_brain_template",
        "route": "local",
        "capabilities": {
          "web_access": false,
          "file_access": false,
          "exec_access": false,
          "device_actions": false
        },
        "latency_ms": 0,
        "tokens_in": null,
        "tokens_out": null,
        "trace_id": "req_79dd62c25ba84bcca927cc379124931a",
        "created_at": "2026-02-16T23:23:50.364691Z",
        "shortcuts_request": false,
        "shortcuts_signature_valid": null,
        "shortcuts_status": "UNVERIFIED",
        "integration": {
          "apple": {
            "shortcuts": "UNVERIFIED"
          }
        }
      },
      "ethics": {
        "outcome": "FIX",
        "reason_codes": [],
        "required_inputs": null,
        "next_action": null,
        "patch": null,
        "commit_meta": {
          "event_id": "cmt_test",
          "timestamp": "2026-02-15T00:00:00Z",
          "subject": "reply",
          "source": "assistant",
          "facet": "CANDIDATE",
          "refs": [
            "chat"
          ],
          "hash": "sha256:test",
          "policy_version": "ethics_protocol_v1_0",
          "redaction": {
            "pii_removed": false,
            "fields": []
          },
          "review": {
            "required": true,
            "state": "pending"
          }
        }
      }
    }
  },
  {
    "timestamp": "2026-02-16T23:37:41.275674Z",
    "event_type": "INACTIVITY_CHECKED",
    "target": "system",
    "summary": "event: INACTIVITY_CHECKED",
    "payload": {
      "rule_id": "INACTIVITY_7D",
      "user_id": "default",
      "triggered": false,
      "reason": "threshold_not_met",
      "next_eligible_at": "2026-02-23T18:29:16.595988Z",
      "days_inactive": 0.21
    }
  },
  {
    "timestamp": "2026-02-16T23:39:00.778389Z",
    "event_type": "CANOPY_EXPORTED",
    "target": "sophia",
    "summary": "canopy dashboard exported",
    "payload": {
      "status_summary": {
        "READY": 0,
        "IN_PROGRESS": 0,
        "DONE": 2,
        "BLOCKED": 3,
        "FAILED": 0,
        "UNVERIFIED": 5
      }
    }
  },
  {
    "timestamp": "2026-02-16T23:39:00.778668Z",
    "event_type": "FOREST_CANOPY_EXPORTED",
    "target": "sophia",
    "summary": "event: FOREST_CANOPY_EXPORTED",
    "payload": {
      "project": "sophia",
      "status_summary": {
        "READY": 0,
        "IN_PROGRESS": 0,
        "DONE": 2,
        "BLOCKED": 3,
        "FAILED": 0,
        "UNVERIFIED": 5
      }
    }
  }
]</div>
    </div>
  </div>
</body>
</html>
