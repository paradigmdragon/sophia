<!doctype html>
<html lang="ko">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Sophia Canopy</title>
  <script type="module">
    import mermaid from "https://cdn.jsdelivr.net/npm/mermaid@11/dist/mermaid.esm.min.mjs";
    mermaid.initialize({ startOnLoad: true, theme: "dark" });
  </script>
  <style>
    body { margin: 0; background: #0b1020; color: #e5e7eb; font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif; }
    .wrap { padding: 20px; display: grid; gap: 14px; }
    .card { background: #111827; border: 1px solid #374151; border-radius: 10px; padding: 12px; }
    .row { display: flex; gap: 12px; flex-wrap: wrap; }
    .pill { background: #1f2937; border: 1px solid #4b5563; border-radius: 999px; padding: 4px 10px; font-size: 12px; }
    .title { font-size: 16px; font-weight: 700; margin: 0 0 8px 0; }
    .stage { font-size: 24px; font-weight: 800; letter-spacing: 0.5px; margin: 0 0 10px 0; }
    .sub { color: #9ca3af; font-size: 12px; }
    .list { font-size: 12px; line-height: 1.5; max-height: 240px; overflow: auto; white-space: pre-wrap; }
  </style>
</head>
<body>
  <div class="wrap">
    <div class="card">
      <p class="title">Canopy Status</p>
      <div class="row">
        <span class="pill">READY: 0</span>
        <span class="pill">IN_PROGRESS: 0</span>
        <span class="pill">DONE: 2</span>
        <span class="pill">BLOCKED: 3</span>
        <span class="pill">FAILED: 0</span>
        <span class="pill">UNVERIFIED: 5</span>
      </div>
      <p class="sub">상태 계산: DB 기반(read-only) · Forest는 export view</p>
    </div>
    <div class="card">
      <p class="title">Question Queue / Work Queue / Recent Events</p>
      <div class="mermaid">flowchart TD
subgraph WorkQueue["Work Queue"]
wp_10cee24315eb4af4ba50c97d61d58713["S2\n[BLOCKED]"]:::BLOCKED
wp_cff76fb7e8ff4229ae0211276eb2b67b["S1\n[DONE]"]:::DONE
wp_c810ebe8cdf04fd49d9425c187dc4af5["Rehearsal S2\n[BLOCKED]"]:::BLOCKED
wp_df90a9828201480db81954abc99fd5ab["Rehearsal S1\n[DONE]"]:::DONE
wp_c910e1aaf5234682b4f2c204822fd480["Part4.5 rehearsal package\n[BLOCKED]"]:::BLOCKED
end
subgraph QuestionQueue["Question Queue"]
q_scope_s2["scope_s2\n[UNVERIFIED]"]:::UNVERIFIED
q_scope_s2b["scope_s2b\n[UNVERIFIED]"]:::UNVERIFIED
q_dep_s1["dep_s1\n[UNVERIFIED]"]:::UNVERIFIED
q_dep_s1b["dep_s1b\n[UNVERIFIED]"]:::UNVERIFIED
q_dependency_missing["dependency_missing\n[UNVERIFIED]"]:::UNVERIFIED
end
classDef READY fill:#1e3a8a,stroke:#93c5fd,color:#dbeafe;
classDef IN_PROGRESS fill:#0f766e,stroke:#5eead4,color:#ccfbf1;
classDef DONE fill:#14532d,stroke:#86efac,color:#dcfce7;
classDef BLOCKED fill:#7f1d1d,stroke:#fca5a5,color:#fee2e2;
classDef FAILED fill:#4c0519,stroke:#f9a8d4,color:#fce7f3;
classDef UNVERIFIED fill:#78350f,stroke:#fcd34d,color:#fef3c7;</div>
    </div>
    <div class="card">
      <p class="title">Recent Events</p>
      <div class="list">[
  {
    "timestamp": "2026-02-17T01:33:48.298573Z",
    "event_type": "QUESTION_SIGNAL",
    "target": "dependency_missing",
    "summary": "question signal: hit=3 risk=0.72",
    "payload": {
      "cluster_id": "dependency_missing",
      "hit_count": 3,
      "risk_score": 0.72,
      "status": "ready_to_ask"
    }
  },
  {
    "timestamp": "2026-02-17T01:33:48.336810Z",
    "event_type": "QUESTION_ASKED",
    "target": "dependency_missing",
    "summary": "question asked: count=1",
    "payload": {
      "cluster_id": "dependency_missing",
      "asked_count": 1,
      "risk_score": 0.72,
      "message_id": "msg_738d680d78894de69a96085364132a81"
    }
  },
  {
    "timestamp": "2026-02-17T01:33:48.380363Z",
    "event_type": "QUESTION_SIGNAL",
    "target": "dependency_missing",
    "summary": "question signal: hit=4 risk=0.72",
    "payload": {
      "cluster_id": "dependency_missing",
      "hit_count": 4,
      "risk_score": 0.72,
      "status": "pending"
    }
  },
  {
    "timestamp": "2026-02-17T01:33:48.424913Z",
    "event_type": "QUESTION_ACKNOWLEDGED",
    "target": "dependency_missing",
    "summary": "event: QUESTION_ACKNOWLEDGED",
    "payload": {
      "cluster_id": "dependency_missing",
      "question_status": "acknowledged",
      "messages_updated": 1
    }
  },
  {
    "timestamp": "2026-02-17T01:33:48.464136Z",
    "event_type": "MESSAGE_READ",
    "target": "msg_738d680d78894de69a96085364132a81",
    "summary": "event: MESSAGE_READ",
    "payload": {
      "message_id": "msg_738d680d78894de69a96085364132a81",
      "status": "acknowledged",
      "linked_cluster": "dependency_missing"
    }
  },
  {
    "timestamp": "2026-02-17T01:33:48.506054Z",
    "event_type": "QUESTION_RESOLVED",
    "target": "dependency_missing",
    "summary": "question resolved",
    "payload": {
      "cluster_id": "dependency_missing",
      "messages_updated": 1,
      "question_status": "resolved"
    }
  },
  {
    "timestamp": "2026-02-17T01:33:48.578855Z",
    "event_type": "QUESTION_SIGNAL",
    "target": "scope_ambiguity",
    "summary": "question signal: hit=1 risk=0.6",
    "payload": {
      "cluster_id": "scope_ambiguity",
      "hit_count": 1,
      "risk_score": 0.6,
      "status": "collecting"
    }
  },
  {
    "timestamp": "2026-02-17T01:33:48.633289Z",
    "event_type": "QUESTION_READY",
    "target": "scope_ambiguity",
    "summary": "question ready: risk=0.82",
    "payload": {
      "cluster_id": "scope_ambiguity",
      "hit_count": 2,
      "risk_score": 0.82
    }
  },
  {
    "timestamp": "2026-02-17T01:33:48.679136Z",
    "event_type": "QUESTION_SIGNAL",
    "target": "scope_ambiguity",
    "summary": "question signal: hit=2 risk=0.82",
    "payload": {
      "cluster_id": "scope_ambiguity",
      "hit_count": 2,
      "risk_score": 0.82,
      "status": "ready_to_ask"
    }
  },
  {
    "timestamp": "2026-02-17T01:33:48.708920Z",
    "event_type": "QUESTION_ASKED",
    "target": "scope_ambiguity",
    "summary": "question asked: count=1",
    "payload": {
      "cluster_id": "scope_ambiguity",
      "asked_count": 1,
      "risk_score": 0.82,
      "message_id": "msg_b6a36278d6824fb6a6bb4493903574c8"
    }
  },
  {
    "timestamp": "2026-02-17T01:33:48.747622Z",
    "event_type": "QUESTION_RESOLVED",
    "target": "scope_ambiguity",
    "summary": "question resolved",
    "payload": {
      "project": "sophia",
      "cluster_id": "scope_ambiguity",
      "messages_updated": 1,
      "question_status": "resolved"
    }
  },
  {
    "timestamp": "2026-02-17T01:33:48.785085Z",
    "event_type": "QUESTION_RESPONSE_ANALYZED",
    "target": "scope_ambiguity",
    "summary": "event: QUESTION_RESPONSE_ANALYZED",
    "payload": {
      "project": "sophia",
      "cluster_id": "scope_ambiguity",
      "signals": 1,
      "source_doc": "question_response_scope_ambiguity_20260217_013348.md"
    }
  },
  {
    "timestamp": "2026-02-17T01:33:48.823413Z",
    "event_type": "ETHICS_FIX_COMMITTED",
    "target": "sophia",
    "summary": "event: ETHICS_FIX_COMMITTED",
    "payload": {
      "project": "sophia",
      "endpoint": "/chat/messages",
      "task": "chat.timeline_append",
      "trace_id": "req_12ea7501008741168a9feb3acc420389",
      "provider_final": "local",
      "fallback_applied": false,
      "gate_reason": "",
      "generation": {
        "provider": "ollama",
        "model": "unknown",
        "route": "local",
        "capabilities": {
          "web_access": false,
          "file_access": false,
          "exec_access": false,
          "device_actions": false
        },
        "latency_ms": 1,
        "tokens_in": null,
        "tokens_out": null,
        "trace_id": "req_12ea7501008741168a9feb3acc420389",
        "created_at": "2026-02-17T01:33:48.629436Z",
        "shortcuts_request": false,
        "shortcuts_signature_valid": null,
        "shortcuts_status": "UNVERIFIED",
        "integration": {
          "apple": {
            "shortcuts": "UNVERIFIED"
          }
        }
      },
      "ethics": {
        "outcome": "FIX",
        "reason_codes": [],
        "required_inputs": null,
        "next_action": null,
        "patch": null,
        "commit_meta": {
          "event_id": "cmt_41969bf9f7b24b06b218ad12d8344c8f",
          "timestamp": "2026-02-17T01:33:48.823186Z",
          "subject": "reply",
          "source": "assistant",
          "facet": "CANDIDATE",
          "refs": [
            "question-queue",
            "msg_8d396a81d528474db7f1ff4fde4a8c9a",
            "msg_d4e465d811a745dbb2426b0e475fc856"
          ],
          "hash": "sha256:e16d27c6aee337ccd33612ac34639caf5a50a18d5814d2ca60a74b8b1b9389c5",
          "policy_version": "ethics_protocol_v1_0",
          "redaction": {
            "pii_removed": false,
            "fields": []
          },
          "review": {
            "required": true,
            "state": "pending"
          }
        }
      }
    }
  },
  {
    "timestamp": "2026-02-17T01:33:48.909534Z",
    "event_type": "ETHICS_FIX_COMMITTED",
    "target": "sophia",
    "summary": "event: ETHICS_FIX_COMMITTED",
    "payload": {
      "project": "sophia",
      "endpoint": "/chat/messages",
      "task": "chat.timeline_append",
      "trace_id": "req_78c1015cf4b249dd80f1588fd1bf912d",
      "provider_final": "local",
      "fallback_applied": false,
      "gate_reason": "",
      "generation": {
        "provider": "mock",
        "model": "unconscious_v0",
        "route": "local",
        "capabilities": {
          "web_access": false,
          "file_access": false,
          "exec_access": false,
          "device_actions": false
        },
        "latency_ms": 0,
        "tokens_in": null,
        "tokens_out": null,
        "trace_id": "req_78c1015cf4b249dd80f1588fd1bf912d",
        "created_at": "2026-02-17T01:33:48.903822Z",
        "shortcuts_request": false,
        "shortcuts_signature_valid": null,
        "shortcuts_status": "UNVERIFIED",
        "integration": {
          "apple": {
            "shortcuts": "UNVERIFIED"
          }
        }
      },
      "ethics": {
        "outcome": "FIX",
        "reason_codes": [],
        "required_inputs": null,
        "next_action": null,
        "patch": null,
        "commit_meta": {
          "event_id": "cmt_2c0cc805cfde4fe3b71d3df0b138a437",
          "timestamp": "2026-02-17T01:33:48.909339Z",
          "subject": "reply",
          "source": "assistant",
          "facet": "CANDIDATE",
          "refs": [
            "chat",
            "msg_32d326bdc1ac4ceb99ee45f56df596c2",
            "msg_46475c52af9d4330893fc0c8e3263ffd"
          ],
          "hash": "sha256:488537d798510d318348eb26bd877ddcd7b21342797e0c1d81aebe204c0c3cef",
          "policy_version": "ethics_protocol_v1_0",
          "redaction": {
            "pii_removed": false,
            "fields": []
          },
          "review": {
            "required": true,
            "state": "pending"
          }
        }
      }
    }
  },
  {
    "timestamp": "2026-02-17T01:33:49.038695Z",
    "event_type": "ETHICS_FIX_COMMITTED",
    "target": "sophia",
    "summary": "event: ETHICS_FIX_COMMITTED",
    "payload": {
      "project": "sophia",
      "endpoint": "/chat/messages",
      "task": "chat.timeline_append",
      "trace_id": "req_b03aefedc23641e4af911c938d68ba1c",
      "provider_final": "local",
      "fallback_applied": false,
      "gate_reason": "",
      "generation": {
        "provider": "mock",
        "model": "unconscious_v0",
        "route": "local",
        "capabilities": {
          "web_access": false,
          "file_access": false,
          "exec_access": false,
          "device_actions": false
        },
        "latency_ms": 0,
        "tokens_in": null,
        "tokens_out": null,
        "trace_id": "req_b03aefedc23641e4af911c938d68ba1c",
        "created_at": "2026-02-17T01:33:49.032439Z",
        "shortcuts_request": false,
        "shortcuts_signature_valid": null,
        "shortcuts_status": "UNVERIFIED",
        "integration": {
          "apple": {
            "shortcuts": "UNVERIFIED"
          }
        }
      },
      "ethics": {
        "outcome": "FIX",
        "reason_codes": [],
        "required_inputs": null,
        "next_action": null,
        "patch": null,
        "commit_meta": {
          "event_id": "cmt_193f2e9dd16e47ffb011bcb331f009f0",
          "timestamp": "2026-02-17T01:33:49.038491Z",
          "subject": "reply",
          "source": "assistant",
          "facet": "CANDIDATE",
          "refs": [
            "chat",
            "msg_0d0a7a827773468fb1d5baabc4fed5a1",
            "msg_9abfa226142543f98f48a6ec8047d5a7"
          ],
          "hash": "sha256:ddca0c074eb9cab333ad4065baac9965908ec77d65629640af6d95ce7df5d868",
          "policy_version": "ethics_protocol_v1_0",
          "redaction": {
            "pii_removed": false,
            "fields": []
          },
          "review": {
            "required": true,
            "state": "pending"
          }
        }
      }
    }
  },
  {
    "timestamp": "2026-02-17T01:34:07.571532Z",
    "event_type": "ETHICS_FIX_COMMITTED",
    "target": "sophia",
    "summary": "event: ETHICS_FIX_COMMITTED",
    "payload": {
      "project": "sophia",
      "endpoint": "/chat/messages",
      "task": "chat.timeline_append",
      "trace_id": "req_4aa107ed1e664aadbe755e1efa3f15fe",
      "provider_final": "local",
      "fallback_applied": false,
      "gate_reason": "",
      "generation": {
        "provider": "mock",
        "model": "unconscious_v0",
        "route": "local",
        "capabilities": {
          "web_access": false,
          "file_access": false,
          "exec_access": false,
          "device_actions": false
        },
        "latency_ms": 0,
        "tokens_in": null,
        "tokens_out": null,
        "trace_id": "req_4aa107ed1e664aadbe755e1efa3f15fe",
        "created_at": "2026-02-17T01:34:07.567674Z",
        "shortcuts_request": false,
        "shortcuts_signature_valid": null,
        "shortcuts_status": "UNVERIFIED",
        "integration": {
          "apple": {
            "shortcuts": "UNVERIFIED"
          }
        }
      },
      "ethics": {
        "outcome": "FIX",
        "reason_codes": [],
        "required_inputs": null,
        "next_action": null,
        "patch": null,
        "commit_meta": {
          "event_id": "cmt_01bdd809d18a447598dd9582fb0a23ba",
          "timestamp": "2026-02-17T01:34:07.571242Z",
          "subject": "reply",
          "source": "assistant",
          "facet": "CANDIDATE",
          "refs": [
            "chat",
            "msg_c5183cc6dc3b4292bef66f55e5bc2594",
            "msg_a1ac1c00167c4b92845ad97d1da7fc0b"
          ],
          "hash": "sha256:f05c9dd2bacb1b3a6c602ef88dcb5ad02f84822a85d5762d0b7922687d471ba5",
          "policy_version": "ethics_protocol_v1_0",
          "redaction": {
            "pii_removed": false,
            "fields": []
          },
          "review": {
            "required": true,
            "state": "pending"
          }
        }
      }
    }
  },
  {
    "timestamp": "2026-02-17T01:35:10.056633Z",
    "event_type": "CANOPY_EXPORTED",
    "target": "sophia",
    "summary": "canopy dashboard exported",
    "payload": {
      "status_summary": {
        "READY": 0,
        "IN_PROGRESS": 0,
        "DONE": 2,
        "BLOCKED": 3,
        "FAILED": 0,
        "UNVERIFIED": 5
      }
    }
  },
  {
    "timestamp": "2026-02-17T01:35:10.056876Z",
    "event_type": "FOREST_CANOPY_EXPORTED",
    "target": "sophia",
    "summary": "event: FOREST_CANOPY_EXPORTED",
    "payload": {
      "project": "sophia",
      "status_summary": {
        "READY": 0,
        "IN_PROGRESS": 0,
        "DONE": 2,
        "BLOCKED": 3,
        "FAILED": 0,
        "UNVERIFIED": 5
      }
    }
  },
  {
    "timestamp": "2026-02-17T01:35:27.781215Z",
    "event_type": "CANOPY_EXPORTED",
    "target": "sophia",
    "summary": "canopy dashboard exported",
    "payload": {
      "status_summary": {
        "READY": 0,
        "IN_PROGRESS": 0,
        "DONE": 2,
        "BLOCKED": 3,
        "FAILED": 0,
        "UNVERIFIED": 5
      }
    }
  },
  {
    "timestamp": "2026-02-17T01:35:27.781417Z",
    "event_type": "FOREST_CANOPY_EXPORTED",
    "target": "sophia",
    "summary": "event: FOREST_CANOPY_EXPORTED",
    "payload": {
      "project": "sophia",
      "status_summary": {
        "READY": 0,
        "IN_PROGRESS": 0,
        "DONE": 2,
        "BLOCKED": 3,
        "FAILED": 0,
        "UNVERIFIED": 5
      }
    }
  }
]</div>
    </div>
    <div class="card">
      <p class="title">Learning Summary</p>
      <p class="stage">SPROUT</p>
      <div class="row">
        <span class="pill">TOTAL: 39</span>
        <span class="pill">NONZERO_KINDS: 5</span>
        <span class="pill">LAST_EVENT: 2026-02-17T01:34:07.570838Z</span>
        <span class="pill">UNCONSCIOUS: 33.3%</span>
        <span class="pill">PREFERENCE: 5.1%</span>
        <span class="pill">TOPIC: 33.3%</span>
      </div>
      <p class="sub">Tracked Events (All)</p>
      <div class="list">{
  "UNCONSCIOUS_HIT": 13,
  "UNCONSCIOUS_PATTERN_SEEN": 7,
  "TERM_MAPPING": 4,
  "TOPIC_SEEN": 13,
  "USER_PREFERENCE": 2
}</div>
      <p class="sub">Tracked Events (24h)</p>
      <div class="list">{
  "UNCONSCIOUS_HIT": 13,
  "UNCONSCIOUS_PATTERN_SEEN": 7,
  "TERM_MAPPING": 4,
  "TOPIC_SEEN": 13,
  "USER_PREFERENCE": 2
}</div>
      <p class="sub">Top Unconscious Patterns</p>
      <div class="list">[
  {
    "pattern_id": "SMOKE_OK",
    "count": 8
  },
  {
    "pattern_id": "GREET",
    "count": 6
  },
  {
    "pattern_id": "PING_OK",
    "count": 3
  },
  {
    "pattern_id": "UNKNOWN_BUT_ACTIONABLE",
    "count": 3
  }
]</div>
    </div>
  </div>
</body>
</html>
